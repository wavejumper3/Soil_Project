<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Graph</title>
    <!-- Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Canvas element to render the chart -->
    <canvas id="lineChart" width="800" height="400"></canvas>

    <script>
        // Function to fetch data from SQLite database using AJAX
        function fetchData() {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            resolve(JSON.parse(xhr.responseText));
                        } else {
                            reject(xhr.statusText);
                        }
                    }
                };
                xhr.open('GET', '/get_data_from_db', true);
                xhr.send();
            });
        }

        // Function to create line chart with fetched data
        async function createLineChart() {
            try {
                // Fetch data from SQLite database
                const data = await fetchData();

                // Extract time and value from data
                const times = data.map(item => item.time);
                const values = data.map(item => item.value);

                // Create line chart
                const ctx = document.getElementById('lineChart').getContext('2d');
                const lineChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: times,
                        datasets: [{
                            label: 'Values',
                            data: values,
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    parser: 'YYYY-MM-DD HH:mm:ss', // Specify date-time format
                                    tooltipFormat: 'll HH:mm:ss', // Format for tooltip
                                },
                                title: {
                                    display: true,
                                    text: 'Time'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Value'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Call function to create line chart
        createLineChart();
    </script>
</body>
</html>

